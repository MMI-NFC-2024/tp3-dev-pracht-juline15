---
import Layout from "../layouts/Layout.astro";
---

<Layout>
    <h1 class="text-2xl m-5">Test Astro et Plot (Observablehq)</h1>
    <a class="text-blue-900 m-5" href="/">Retour aux étapes</a>

    <nav class="m-5">
        <label for="species" class="mr-2">Choisissez une espèce :</label>
        <select id="species">
            <option value="Adelie">Adelie</option>
            <option value="Chinstrap">Chinstrap</option>
            <option value="Gentoo">Gentoo</option>
        </select>
    </nav>

    <iframe
        name="penguin-frame"
        src="/species/Adelie/"
        id="penguin-iframe"
        style="width:100%; min-height:800px;"
    >
    </iframe>
</Layout>

<script>
    function resizeIframe(iframe) {
        try {
            setTimeout(() => {
                const iframeDocument =
                    iframe.contentDocument || iframe.contentWindow.document;
                const body = iframeDocument.body;
                const html = iframeDocument.documentElement;

                const height = Math.max(
                    body.scrollHeight,
                    body.offsetHeight,
                    html.clientHeight,
                    html.scrollHeight,
                    html.offsetHeight,
                );

                const minHeight = 400;
                const maxHeight = 1200;
                const finalHeight = Math.max(
                    minHeight,
                    Math.min(height + 50, maxHeight),
                );

                iframe.style.height = finalHeight + "px";
            }, 100);
        } catch (error) {
            console.warn(
                "Impossible de redimensionner l'iframe automatiquement:",
                error,
            );
            iframe.style.height = "600px";
        }
    }

    window.addEventListener("resize", () => {
        const iframe = document.getElementById("penguin-iframe");
        if (iframe) {
            resizeIframe(iframe);
        }
    });

    document.addEventListener("DOMContentLoaded", () => {
        const iframe = document.getElementById("penguin-iframe");
        if (iframe) {
            iframe.addEventListener("load", () => {
                resizeIframe(iframe);
            });
        }

        const select = document.getElementById("species");
        select?.addEventListener("change", (evt) => {
            const value = evt.target.value;
            const iframe = document.getElementById("penguin-iframe");
            if (iframe) {
                iframe.src = `/species/${value}/`;
            }
        });
    });
</script>
